<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mini App</title>
    
    <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
    <meta name="referrer" content="no-referrer">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content:">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #ffffff;
            color: #000000;
        }
        button { 
            background: #40a7e3;
            color: #ffffff;
            border: none;
            padding: 12px 20px;
            margin: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        #status {
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Mini App</h1>
    <div id="connection-status">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</div>
    
    <button onclick="sendSimpleData()" id="send-btn" disabled>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    <div id="status">–°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ Telegram API
        function checkTelegramLoaded() {
            let checkCount = 0;
            const maxChecks = 10;
            
            const checkInterval = setInterval(() => {
                checkCount++;
                
                if (window.Telegram && window.Telegram.WebApp) {
                    clearInterval(checkInterval);
                    initApp();
                } else if (checkCount >= maxChecks) {
                    clearInterval(checkInterval);
                    showError('Telegram API –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞!');
                }
            }, 500);
        }

        function initApp() {
            document.getElementById('connection-status').textContent = '‚úÖ Telegram API –ø–æ–¥–∫–ª—é—á–µ–Ω';
            document.getElementById('send-btn').disabled = false;
            document.getElementById('status').textContent = '–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤–æ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ';
            
            const tg = window.Telegram.WebApp;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            tg.ready();
            tg.expand();
            
            console.log('‚úÖ Mini App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            console.log('üë§ User:', tg.initDataUnsafe.user);
            console.log('üåê Init Data:', tg.initData);
        }

        function showError(message) {
            document.getElementById('connection-status').className = 'error';
            document.getElementById('connection-status').textContent = '‚ùå ' + message;
            document.getElementById('status').textContent = '–°—Ç–∞—Ç—É—Å: –û—à–∏–±–∫–∞';
        }

        function sendSimpleData() {
            if (!window.Telegram || !window.Telegram.WebApp) {
                showError('Telegram API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                return;
            }

            const tg = window.Telegram.WebApp;
            const data = {
                action: 'test_from_github',
                message: '–î–∞–Ω–Ω—ã–µ —Å GitHub Pages!',
                timestamp: new Date().toISOString(),
                random_id: Math.random().toString(36).substr(2, 9),
                user_id: tg.initDataUnsafe.user?.id || 'unknown'
            };
            
            document.getElementById('status').textContent = '–°—Ç–∞—Ç—É—Å: –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            try {
                tg.sendData(JSON.stringify(data));
                document.getElementById('status').textContent = '‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!';
                console.log('üì§ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã:', data);
            } catch (error) {
                document.getElementById('status').textContent = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', checkTelegramLoaded);
        
        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        setTimeout(checkTelegramLoaded, 1000);
    </script>
</body>
</html>
